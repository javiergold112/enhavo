parameters:
    security.authentication.voter.group_role_voter.class: Enhavo\Bundle\UserBundle\Security\Authentication\Voter\GroupRoleVoter
    enhavo_user.event.save_user.class: Enhavo\Bundle\UserBundle\EventListener\SaveUserSubscriber

services:
    enhavo_user.event.save_user:
        class: %enhavo_user.event.save_user.class%
        arguments:
            - @fos_user.user_manager
        tags:
            - { name: kernel.event_subscriber }

    enhavo_user_user:
        class: %enhavo_user.form.type.user.class%
        tags:
            - { name: form.type }

    enhavo_user_profile:
        class: Enhavo\Bundle\UserBundle\Form\Type\ProfileType
        arguments:
            - %enhavo_user.model.user.class%
        tags:
            - { name: form.type }

    enhavo_user_group:
        class: %enhavo_user.form.type.group.class%
        tags:
            - { name: form.type }
        arguments:
            - @security.roles.provider

    security.authentication.voter.group_role_voter:
        class:      %security.authentication.voter.group_role_voter.class%
        public:     false
        tags:
            - { name: security.voter }

    enhavo_user.extend_listener.user:
        class: Enhavo\Bundle\AppBundle\EventListener\DoctrineExtendListener
        arguments:
            - Enhavo\Bundle\UserBundle\Entity\User
            - %enhavo_user.model.user.class%
            - true
        tags:
            - { name: doctrine.event_subscriber, connection: default }

    enhavo_user.extend_listener.group:
        class: Enhavo\Bundle\AppBundle\EventListener\DoctrineExtendListener
        arguments:
            - Enhavo\Bundle\UserBundle\Entity\Group
            - %enhavo_user.model.group.class%
            - true
        tags:
            - { name: doctrine.event_subscriber, connection: default }

    enhavo_user.menu_builder.user:
        class: Enhavo\Bundle\UserBundle\Menu\UserMenuBuilder
        calls:
          - [ 'setContainer', ['@service_container']]
        tags:
            - { name: enhavo.menu }

    enhavo_user.menu_builder.group:
        class: Enhavo\Bundle\UserBundle\Menu\GroupMenuBuilder
        calls:
          - [ 'setContainer', ['@service_container']]
        tags:
            - { name: enhavo.menu }

    enhavo_user.widget.login:
        class: Enhavo\Bundle\UserBundle\Widget\LoginWidget
        calls:
            - [setContainer, ['@service_container']]
        tags:
            - { name: enhavo.theme_widget }

    enhavo_user.controller.security:
        class: Enhavo\Bundle\UserBundle\Controller\SecurityController
        arguments:
            - '@sylius.resource_controller.request_configuration_factory'
            - '@viewer.factory'
            - '@fos_rest.view_handler'
        calls:
            - [setContainer, ['@service_container']]

    enhavo_user.viewer.reset_password:
        class: Enhavo\Bundle\UserBundle\Viewer\ResetPasswordViewer
        calls:
            - [setContainer, ['@service_container']]
        tags:
            - { name: enhavo.viewer }
