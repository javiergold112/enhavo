services:
    enhavo_block.context.builder:
        class: Enhavo\Bundle\BlockBundle\Context\ContextBuilder

    Enhavo\Bundle\BlockBundle\Form\Type\BlocksType:
        arguments:
            - Enhavo\Bundle\BlockBundle\Entity\Node
        tags:
            - { name: form.type }

    enhavo_block.twig.container_extension:
        class: Enhavo\Bundle\BlockBundle\Twig\ContainerExtension
        arguments:
            - '@enhavo_block.renderer.block_renderer'
        calls:
            - [ setContainer, ['@service_container']]
        tags:
            - { name: twig.extension }

    enhavo_block.renderer.block_renderer:
        class: Enhavo\Bundle\BlockBundle\Renderer\ContainerRenderer
        arguments:
            - '@enhavo_block.resolver.block_resolver'
            - '@enhavo_block.context.builder'
            - '%enhavo_block.render.sets%'
        calls:
            - [ setContainer, ['@service_container']]

    enhavo_block.resolver.block_resolver:
        public: true
        class: Enhavo\Bundle\BlockBundle\Resolver\BlockResolver
        calls:
            - ['setContainer', ['@service_container']]
        arguments:
            - '@form.factory'
            - '@enhavo_block.factory.block'
            - '@enhavo_block.block.manager'

    enhavo_block.block_collector:
        class: Enhavo\Bundle\AppBundle\Type\TypeCollector
        arguments:
            - '@service_container'
            - 'ContainerBlock'

    validator.video_url_validator:
        class:  Enhavo\Bundle\BlockBundle\Validator\Constraints\VideoUrlValidator
        tags:
            - { name: validator.constraint_validator, alias: video_url }

    enhavo_block.event_listener.block_reference:
        class: Enhavo\Bundle\AppBundle\EventListener\DoctrineReferenceListener
        arguments:
          - 'Enhavo\Bundle\BlockBundle\Entity\Node'
          - 'block'
          - 'blockClass'
          - 'blockId'
          - '@enhavo_app.reference.target_class_resolver'
        tags:
            - { name: doctrine.event_subscriber }

    enhavo_block.block.manager:
        class: Enhavo\Bundle\BlockBundle\Block\BlockManager
        arguments:
            - '@enhavo_block.block_collector'
            - '%enhavo_block.blocks%'
